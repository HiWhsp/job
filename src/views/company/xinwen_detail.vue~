<template>
  <div class="content">
    <div class="top flex">
      <div class="title">{{ data.title }}</div>
      <div class="info flex">
        <div class="desc"><span>发布时间：</span>{{ data.dtTime }}</div>
        <div class="desc"><span>来源：</span>富俊机械</div>
      </div>
    </div>
    <div class="cont" v-html="data.content"></div>
    <div class="toBuy">
      <div class="up pointer" @click="toBuy('up')">
        {{ productsToBuy[0] ? '上一条 : ' + productsToBuy[0].title : '' }}
      </div>
      <div class="down pointer" @click="toBuy('down')">
        {{ productsToBuy[1] ? '下一条 : ' + productsToBuy[1].title : '' }}
      </div>
    </div>
  </div>
</template>

<script>
export default {
  name: "xinwen_detail",
  data() {
    return {
      data: {},
      productsToBuy: [],
      allToBuy: []
    }
  },
  mounted() {
    this.$api({
      url: '/service.php',
      method: 'get',
      data: {
        action: 'news_detail',
        channelId: 3,
        id: this.$route.query.id,
        isIndex: 0
      }
    }).then(res => {
      if (res.code == 200) {
        this.data = res.data.info;
      }
    })
    this.setView();
  },
  methods: {
    setView() {
      this.$api({
        url: '/service.php',
        method: 'get',
        data: {
          action: 'news_lists',
          ...{
            channelId: 50,
            page: 1,
            pageNum: 12,
            isIndex: 0,
            orderType: 0
          }
        }
      }).then(res => {
        if (res.code == 200) {
          this.allToBuy = res.data.list;
          this.allToBuy.forEach((item, index) => {
            console.log(item.id, this.$route.query.id)
            if (item.id == this.$route.query.id) {
              this.productsToBuy = [this.allToBuy[index - 1] ? this.allToBuy[index - 1] : null, this.allToBuy[index + 1] ? this.allToBuy[index + 1] : null];
            }
          })
        }
      })
    },
    toBuy(type) {
      if (type == 'down') {
        const start = this.productsToBuy[1];
        let end = [];
        for (let i = 0; i < this.allToBuy.length; i++) {
          if (this.productsToBuy[1].id == this.allToBuy[i].id) {
            end = this.allToBuy[i + 1] ? this.allToBuy[i + 1] : null;
            sessionStorage.setItem("productsToBuy", JSON.stringify([start, end]));
            sessionStorage.setItem("allToBuy", JSON.stringify(this.allToBuy));
            this.$router.push('/xinhun-detail?id=' + this.productsToBuy[1].id);
          }
        }
      } else if (type == 'up') {
        const end = this.productsToBuy[0];
        let start = [];
        for (let i = 0; i < this.allToBuy.length; i++) {
          if (this.productsToBuy[0].id == this.allToBuy[i].id) {
            start = this.allToBuy[i - 1] ? this.allToBuy[i - 1] : null;
            sessionStorage.setItem("productsToBuy", JSON.stringify([start, end]));
            sessionStorage.setItem("allToBuy", JSON.stringify(this.allToBuy));
            this.$router.push('/xinhun-detail?id=' + this.productsToBuy[0].id);
          }
        }
      }
      location.reload();
    }
  }
}
</script>

<style scoped lang="less">
.content {
  padding: 62px 0 54px;
  background-color: #fff;
  .flex();
  flex-direction: column;
  align-items: center;

  .top {
    padding-bottom: 22px;
    width: 1500px;
    flex-direction: column;
    align-items: center;
    border-bottom: 1px solid #C9C9C9;

    .title {
      font-family: Roboto, Roboto;
      font-weight: bold;
      font-size: 28px;
      color: #000;
    }

    .info {
      margin-top: 40px;

      .desc {
        margin-right: 46px;

        span {
          margin-right: 24px;
        }
      }
    }
  }

  .cont {
    margin-top: 20px;
    width: 1500px;
    flex-direction: column;
    align-items: center;
    padding-bottom: 20px;
  }

  .toBuy {
    padding-top: 20px;
    width: 1500px;
    flex-direction: column;
    align-items: center;
    border-top: 1px solid #C9C9C9;

    font-family: Microsoft YaHei, Microsoft YaHei;
    font-weight: 400;
    font-size: 16px;
    color: #000000;

    .down {
      margin-top: 24px;
    }
  }
}
</style>
